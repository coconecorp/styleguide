# C++スタイルガイド

<details><summary>目次</summary>

- [C++スタイルガイド](#cスタイルガイド)
  - [はじめに](#はじめに)
  - [C++のバージョン](#cのバージョン)
  - [ヘッダファイル](#ヘッダファイル)
    - [自己完結型ヘッダー](#自己完結型ヘッダー)
    - [インクルードガード](#インクルードガード)
    - [インライン関数](#インライン関数)
    - [インクルードの名前と順序](#インクルードの名前と順序)
    - [例外](#例外)
  - [スコープ](#スコープ)
    - [名前空間](#名前空間)
    - [無名名前空間と静的変数](#無名名前空間と静的変数)
    - [グローバル関数](#グローバル関数)
    - [静的メンバ関数](#静的メンバ関数)
    - [ローカル変数](#ローカル変数)
    - [静的変数とグローバル変数](#静的変数とグローバル変数)
  - [クラス](#クラス)
    - [コンストラクタ](#コンストラクタ)
    - [暗黙的型変換](#暗黙的型変換)
    - [コピー可能な型・ムーブ可能な型](#コピー可能な型ムーブ可能な型)
    - [構造体かクラスか](#構造体かクラスか)
    - [構造体とペアおよびタプル](#構造体とペアおよびタプル)
    - [継承](#継承)
    - [演算子のオーバーロード](#演算子のオーバーロード)
    - [アクセス制限](#アクセス制限)
    - [宣言の順序](#宣言の順序)
  - [関数](#関数)
    - [入力と出力](#入力と出力)
    - [関数の長さ](#関数の長さ)
    - [関数のオーバーロード](#関数のオーバーロード)
    - [引数のデフォルト値](#引数のデフォルト値)
    - [戻り値の型を後置する関数宣言構文](#戻り値の型を後置する関数宣言構文)
  - [特有のルール](#特有のルール)
    - [スマートポインタの所有権](#スマートポインタの所有権)
  - [その他のC++の機能](#その他のcの機能)
    - [右辺値参照](#右辺値参照)
    - [フレンド](#フレンド)
    - [例外](#例外-1)
    - [noexcept](#noexcept)
    - [キャスト](#キャスト)
    - [ストリーム](#ストリーム)
    - [constの使い方](#constの使い方)
    - [constexprの使い方](#constexprの使い方)
    - [整数型](#整数型)
    - [整数型64ビットへの移植性](#整数型64ビットへの移植性)
    - [プリプロセッサマクロ](#プリプロセッサマクロ)
    - [0とnullptrとNULL](#0とnullptrとnull)
    - [sizeof](#sizeof)
    - [型推論（autoを含む）](#型推論autoを含む)
    - [クラステンプレートのテンプレート引数推論](#クラステンプレートのテンプレート引数推論)
    - [ラムダ式](#ラムダ式)
    - [テンプレートメタプロラミング](#テンプレートメタプロラミング)
    - [boost](#boost)
    - [std::hash](#stdhash)
    - [その他のC++の機能](#その他のcの機能-1)
    - [非標準の拡張](#非標準の拡張)
    - [エイリアス](#エイリアス)
  - [命名規則](#命名規則)
    - [一般的な命名規則](#一般的な命名規則)
    - [ファイル名](#ファイル名)
    - [型の名前](#型の名前)
    - [変数名](#変数名)
    - [定数名](#定数名)
    - [関数名](#関数名)
    - [名前空間](#名前空間-1)
    - [列挙型](#列挙型)
    - [マクロ](#マクロ)
    - [命名規則の例外](#命名規則の例外)
  - [コメント](#コメント)
    - [コメントスタイル](#コメントスタイル)
    - [クラスのコメント](#クラスのコメント)
    - [関数のコメント](#関数のコメント)
    - [変数のコメント](#変数のコメント)
    - [実装のコメント](#実装のコメント)
    - [関数の引数のコメント](#関数の引数のコメント)
    - [TODOコメント](#todoコメント)
  - [コードのフォーマット](#コードのフォーマット)
    - [行の長さ](#行の長さ)
    - [非ASCII文字](#非ascii文字)
    - [インデント](#インデント)
    - [関数宣言と関数定義](#関数宣言と関数定義)
    - [ラムダ式](#ラムダ式-1)
    - [浮動小数点リテラル](#浮動小数点リテラル)
    - [関数呼び出し](#関数呼び出し)
    - [波括弧による初期化子リスト](#波括弧による初期化子リスト)
    - [条件文](#条件文)
    - [switch文](#switch文)
    - [ループ](#ループ)
    - [ポインタと参照の表現](#ポインタと参照の表現)
    - [ブーリアンの表現](#ブーリアンの表現)
    - [戻り値](#戻り値)
    - [変数と配列の初期化](#変数と配列の初期化)
    - [プリプロセッサディレクティブ](#プリプロセッサディレクティブ)
    - [クラス](#クラス-1)
    - [コンストラクタの初期化子リスト](#コンストラクタの初期化子リスト)
    - [名前空間のフォーマット](#名前空間のフォーマット)
    - [水平方向](#水平方向)

</details>

## はじめに

- 本ガイドラインは、[ココネ株式会社](https://www.cocone.co.jp/)におけるC++のコーディング規則を示すものです。
- 本ガイドラインは、『[Google C\+\+ Style Guide](https://google.github.io/styleguide/cppguide.html)』を参考に規定しています。
- 本ガイドラインで未定義のスタイルや、詳細を定義していない箇所の議論となった場合は、『[Google C\+\+ Style Guide](https://google.github.io/styleguide/cppguide.html)』を参考に検討することとします。

<div align="right">
<a href="#">⬆️ 先頭に戻る</a>
</div>

## C++のバージョン

- 【推奨】開発にはC++17の使用を推奨しています。C++2xの使用は推奨しません。

<div align="right">
<a href="#">⬆️ 先頭に戻る</a>
</div>

## ヘッダファイル

### 自己完結型ヘッダー

- 【必須】関数テンプレートや`inline`関数は、宣言と同じファイルに書かなければなりません。
- 【推奨】`.h`ファイルは、自己完結型ヘッダーにし、好きな場所から`include`できるようにすることを推奨します。
- 【推奨】`.cpp`ファイルには、`.h`ファイルを対応させることを推奨します。なお、unit testや`main()`だけを含む小さい`.cpp`ファイルは、対応しなくてよいこととします。

<div align="right">
<a href="#">⬆️ 先頭に戻る</a>
</div>

### インクルードガード

- 【必須】ヘッダファイルは、インクルードガード`#define guards`を使用しなければなりません。
- 【必須】シンボル名は、`<PROJECT>_<PATH>_<FILE>_H_`の形を使用しなければなりません。
- 【必須】ソースファイルやヘッダーファイルが、他の場所で定義されているシンボルを参照しない場合、ヘッダーファイルを含めてはいけません。

<div align="right">
<a href="#">⬆️ 先頭に戻る</a>
</div>

### インライン関数

- 【必須】インライン関数は、関数の定義が小さいとき（10行以下）だけ使用しなければなりません。

<div align="right">
<a href="#">⬆️ 先頭に戻る</a>
</div>

### インクルードの名前と順序

- 【必須】インクルードは、UNIXディレクトリショートカットのカレントディレクトリ`.`や、親ディレクトリ`..`の指定をしてはいけません。
- 【推奨】可読性を保つため、また依存関係が隠れるのを防ぐため、次の順序でヘッダをインクルードすることを推奨します。

1. Cライブラリヘッダ
2. C++標準ライブラリのヘッダ
3. 他のライブラリヘッダ
4. 関連するヘッダ
5. 自分のプロジェクトのヘッダ

<div align="right">
<a href="#">⬆️ 先頭に戻る</a>
</div>

### 例外

条件付きインクルードは、最後に配置してよいこととします。

```cpp
#include "foo/public/fooserver.h"

#include "base/port.h"  // For LANG_CXX11.

#ifdef LANG_CXX11
#include <initializer_list>
#endif  // LANG_CXX11
```

<div align="right">
<a href="#">⬆️ 先頭に戻る</a>
</div>

## スコープ

### 名前空間

- 【必須】名前空間は、プロジェクト名やファイルのパスにもとづいて一意の名前をつけなければなりません。
- 【必須】インライン名前空間は、使用してはいけません。
- 【必須】名前空間は、`include`文や`gflags`の定義と宣言、他の名前空間のクラスの前方宣言の後に続くソースコードをすべて包まなければなりません。
- 【必須】`std`名前空間の中には、標準ライブラリの前方宣言を含めて、何も宣言しないようにしなければなりません。
- 【推奨】細かい例外を除き、コードは名前空間の中に置くことを推奨します。
- 【推奨】名前空間の終わりは、コメントを付けることを推奨します。

```cpp
namespace outer {
  inline namespace inner {
    void foo();
  }  // namespace inner
}  // namespace outer
```

<div align="right">
<a href="#">⬆️ 先頭に戻る</a>
</div>

### 無名名前空間と静的変数

- 【必須】`.cpp`ファイル中の定義がファイルの外で不要な場合、無名の名前空間内で宣言するか、`static`宣言をしなければなりません。
- 【必須】宣言は`.h`に置いてはいけません。

<div align="right">
<a href="#">⬆️ 先頭に戻る</a>
</div>

### 静的メンバ関数

- 【推奨】静的メンバ関数は、そのクラスのインスタンスや静的メンバ変数と関連性が強い場合のみ使用を推奨します。

<div align="right">
<a href="#">⬆️ 先頭に戻る</a>
</div>

### ローカル変数

- 【必須】関数内の変数は、可能な限りそのスコープを狭めるようにしなければなりません。
- 【推奨】関数内の変数は、宣言と同時に初期化を推奨します。

```cpp
// 推奨：宣言と同時に初期化が行われている
int j = g();

// 推奨：宣言と同時に初期化が行われている
int i = 0;
i = f();

// 非推奨：初期化が宣言と分かれている。
int i;
i = f();
```

- 【必須】`if`文や`while`文、`for`文で使用する変数は、外で宣言するほうが効率的になる場合を除き、文の中で宣言しなければなりません。

```cpp
// 良い例
while (const char* p = strchr(str, '/')) str = p + 1;
````

```cpp
// 悪い例：非効率な実装
for (int i = 0; i < 1000000; ++i) {
    Foo f;
    f.DoSomething(i);
}

// 良い例：効率的な実装
Foo f;
for (int i = 0; i < 1000000; ++i) {
    f.DoSomething(i);
}
```

<div align="right">
<a href="#">⬆️ 先頭に戻る</a>
</div>

### 静的変数とグローバル変数

- 【必須】`static storage duration` は、デストラクタが実質何もしない場合以外、使用してはいけません。
- 【必須】関数スコープの`static`変数の動的初期化はしなければなりません。
- 【必須】`constexpr`は、`static storage duration`を使用しなければなりません。
- 【推奨】`static`クラスメンバや、`namespace`スコープ変数の動的初期化は、推奨しません。

<div align="right">
<a href="#">⬆️ 先頭に戻る</a>
</div>

## クラス

### コンストラクタ

- 【必須】コンストラクタでの、仮想メソッドの呼び出しはしてはいけません。

「[TotW #42](https://abseil.io/tips/42)」で説明しているような、ファクトリ関数や`Init()`メソッドの導入を検討しましょう。

<div align="right">
<a href="#">⬆️ 先頭に戻る</a>
</div>

### 暗黙的型変換

- 暗黙的型変換の新たな定義はお勧めしません。型変換演算子や、1つの引数をとるコンストラクタでは`explicit`の使用をお勧めします。

例外として、コピーコンストラクタとムーブコンストラクタは`explicit`でのマークを推奨しません。これらは型変換をしません。

- 1つの引数では呼び出せないコンストラクタは、`explicit`を省略してよいこととします。
- 1つの`std::initializer_list`型の引数をとるコンストラクタは、コピーによる初期化（例：`MyType m = {1, 2};`）をサポートするために、`explicit`を省略してよいこととします。

<div align="right">
<a href="#">⬆️ 先頭に戻る</a>
</div>

### コピー可能な型・ムーブ可能な型

- 【推奨】コピーや代入演算子を指定する場合は、対応するコンストラクタの指定を推奨します。
- 【推奨】コピーや移動の意味が不明確な場合、または予期しないコストが発生する場合は、型のコピーや移動を不可能にすることを推奨します。
- 公開APIとしてのクラスは、そのクラスがコピー可能なのかムーブしかできないのか、コピーやムーブもできないのか、明示してよいこととします。
- すべてのクラスのパブリックインターフェースは、 そのクラスがサポートするコピーや移動の操作を明確してよいこととします。これは通常、`public`宣言のセクションで適切な操作を明示的に宣言、または削除するという形をとります。
- コピー可能なクラスは、コピー操作を明示的に宣言し、移動のみのクラスは移動操作を明示的に宣言し、コピー不可能/移動可能なクラスはコピー操作を明示的に削除してよいこととします。

<div align="right">
<a href="#">⬆️ 先頭に戻る</a>
</div>

### 構造体かクラスか

- 【必須】`struct`は、データを運ぶためだけの受動的なオブジェクトに使用しなければなりません。
- 【必須】`struct`は、定数が関連付けられている場合があります。すべてのフィールドは`public`にしなければなりません。

<div align="right">
<a href="#">⬆️ 先頭に戻る</a>
</div>

### 構造体とペアおよびタプル

- 【必須】`struct`に意味のある名前を付与できる場合は、ペアやタプルではなく`struct`を使用しなければなりません。

<div align="right">
<a href="#">⬆️ 先頭に戻る</a>
</div>

### 継承

- 【必須】すべての継承は、`public`で行わなければなりません。
- 【必須】`private`な継承する場合は、継承の代わりに基底クラスのインスタンスをメンバとしてもたせなければなりません。
- 【必須】実装の継承を多用してはいけません。抱合（コンポジション）の方が適切な場合もしばしばあります。継承は、`is-a`関係が成立する場合のみ使用しなければなりません。
- 【必須】`protected`は、派生クラスからアクセスされるメンバ関数だけにとどめなければなりません。データメンバは`private`を使用しなければなりません。

<div align="right">
<a href="#">⬆️ 先頭に戻る</a>
</div>

### 演算子のオーバーロード

- 【必須】演算子のオーバーロードは、慎重に、自然で一貫した挙動が定義できるときだけです。ユーザ定義のリテラルは、使用してはいけません。
- 【必須】演算子定義は、自分の作った型に対してのみに限定し、同じ`.h`、`.cpp`ファイル、`namespace`に置かなければなりません。多重定義の動作が不定になるリスクを避けることができます。
- 【推奨】演算子`&&`、`||`、`,`（カンマ演算子）、単項演算子`&`のオーバーロードは推奨しません。
- 【推奨】`operator""`のオーバーロードも推奨しません。

<div align="right">
<a href="#">⬆️ 先頭に戻る</a>
</div>

### アクセス制限

- 【必須】クラスのデータメンバーは、`private`としなければなりません。

ただし`static const`（定数に関する命名規則も参照）は除きます。

<div align="right">
<a href="#">⬆️ 先頭に戻る</a>
</div>

### 宣言の順序

- 【必須】クラス定義内に、大きいメソッドの定義をインラインで定義してはいけません。
- 【推奨】クラスの定義は、通常は`public:`セクションからの開始し、`protected:`、`private:`と続けることを推奨します。空になるセクションは省略します。

<div align="right">
<a href="#">⬆️ 先頭に戻る</a>
</div>


## 関数

### 入力と出力

- 【必須】関数の出力は、出力パラメータよりも戻り値で返すか、それができない場合は参照で返さなければなりません。
- 【必須】関数の出力をポインタで返すことは、`NULL`にできない限り避けなければなりません。
- 【必須】オプションではない入力パラメータは、通常、値または`const`の参照を使用しなければなりません。
- 【必須】オプションではない出力パラメータや、`input/output`パラメータは、参照（`null`にはできません）を使用しなければなりません。
- 【必須】`const`の参照パラメータは、一時的に束縛されます。呼び出しよりも長く存続する目的で、`const`参照パラメータを必要とする関数の定義は避けなければなりません。

<div align="right">
<a href="#">⬆️ 先頭に戻る</a>
</div>

### 関数の長さ

- 【推奨】関数の長さは、短く焦点を絞った形を推奨します。
- 【推奨】関数の長さは、40行以内を推奨します。40行を超えるようであれば、分割の検討をしてください。

<div align="right">
<a href="#">⬆️ 先頭に戻る</a>
</div>

### 関数のオーバーロード

- 【推奨】関数のオーバーロードは、読書がオーバーロードの動作が容易に理解できない場合、使用を推奨しません。

例：次の関数は、`const string &`を引数にとる関数と、`const char *`を引数にとるオーバーロードとを書くことができますが、`std::string_view`の使用を検討します。

```cpp
class MyClass {
    public:
        void Analyze(const string &text);
        void Analyze(const char *text, size_t textlen);
};
```

<div align="right">
<a href="#">⬆️ 先頭に戻る</a>
</div>

### 引数のデフォルト値

- 【必須】引数のデフォルト値は、対象の関数が仮想関数ではなく、値が常に同じ値だと保証できる場合に限らなければなりません。
- 【必須】仮想関数の引数に、デフォルト値を設定した場合、意図したとおりに動作しないため、使用を禁止します。
- 【必須】引数のデフォルト値が、評価のタイミングで必ず同じ値にならない場合、使用を禁止します（例：`void f(int n = counter++);`）。

<div align="right">
<a href="#">⬆️ 先頭に戻る</a>
</div>

### 戻り値の型を後置する関数宣言構文

- 【必須】関数宣言の構文は、戻り値の型が関数名より先に来る関数宣言の構文を使用しなければなりません。

```cpp
// 推奨：
int foo(int x);

// 非推奨：戻り値型の後置文法
auto foo(int x) -> int;
```

戻り値型の後置文法は、ラムダ式のようなどうしても必要な場合と、引数のリストの後ろに戻り値の型を置くことで、可読性が向上する場合のみ使用します。

<div align="right">
<a href="#">⬆️ 先頭に戻る</a>
</div>


## 特有のルール

ココネ株式会社は、C++のコードをより堅牢にする目的で、[Google C\+\+ Style Guide](https://google.github.io/styleguide/cppguide.html)の『[Google特有のマジック](https://google.github.io/styleguide/cppguide.html#Google-Specific_Magic)』を参考に、特有のコーディング規則を規定しています。

### スマートポインタの所有権

- 【必須】動的に確保されるオブジェクトの所有者は、単一で固定されるようにしなければなりません。
- 【必須】オブジェクトの所有権を移すときは、スマートポインタを使用しなければなりません。
- 【必須】他のコードがオブジェクトにアクセスしないといけないときは、コピーを渡すか、所有権を渡さずにポインタや参照を渡さなければなりません。
- 【必須】正当な理由がない限り、オブジェクトの所有権を共有する設計はしてはいけません。
- 【必須】所有権を共有したい場合は、`std::shared_ptr`を使用しなければなりません。
- 【必須】`std::auto_ptr`は使用してはいけません。かわりに、`std::unique_ptr`を使用しなければなりません。

<div align="right">
<a href="#">⬆️ 先頭に戻る</a>
</div>

## その他のC++の機能

### 右辺値参照

- 【必須】右辺値参照は、ムーブコンストラクタやムーブ代入演算子を定義するときに使用しなければなりません。
- 【必須】右辺値参照は、次の場合で、 `const&`や`&&`の変数に対する、オーバーロードを定義するときに使用しなければなりません。
  - 単なる値渡しよりも、パフォーマンス面で優位性があるとわかっている場合
  - 任意の型のサポートが必要な、汎用的な低オーバーヘッドのコードを書こうとしている場合
- 【必須】右辺値参照は、汎用的なコードにおいて、完全転送（perfect forwarding）をサポートしたいときに使用しなければなりません。

<div align="right">
<a href="#">⬆️ 先頭に戻る</a>
</div>

### フレンド

- 【推奨】`friend`クラスや`friend関数`は、ビルダークラスなど、使用する理由がある場合のみ使用を推奨します。

<div align="right">
<a href="#">⬆️ 先頭に戻る</a>
</div>

### 例外

- 【推奨】例外の使用は、推奨しません。

これは、C++11で導入された例外に関連する機能（`std::exception_ptr`、`std::nested_exception`など）についても同様です。

<div align="right">
<a href="#">⬆️ 先頭に戻る</a>
</div>

### noexcept

- 【推奨】パフォーマンス上意味あり、関数の意図したセマンティクスを正確に反映している場合のみ、`noexcept`を使用を推奨します。
- 【推奨】例外が完全に禁止されているような環境は、`noexcept`の使用を推奨します。

<div align="right">
<a href="#">⬆️ 先頭に戻る</a>
</div>

### キャスト

- 【必須】`const`修飾子を取り除くときは、`const_cast`を使用しなければなりません。
- 【推奨】数値型のアップキャストには、波括弧`{}`の使用を推奨します。型変換によって情報が失われるときにコンパイルエラーとなるため、安全です。

<div align="right">
<a href="#">⬆️ 先頭に戻る</a>
</div>

### ストリーム

- 【推奨】ストリームは、デバッグログやテスト用を中心に、単純に使用できるときのみ使用します。

<div align="right">
<a href="#">⬆️ 先頭に戻る</a>
</div>

### constの使い方

- 【必須】`const`は、先頭に書かなければなりません。
- 【必須】`int const *foo`ではなく、`const int* foo`と書かなければなりません。
- 【推奨】ローカル変数について、`const`の使用は推奨しません。
- 理にかなっている場合、`const`の使用をお勧めします。C++11では、`constexpr`の使用も検討します。
- `const`な変数、データメンバ、メンバ関数、引数は、コンパイル時に追加のチェックを行うことができるため、問題の早期発見に役立ちます。適切な場合は、`const`の使用をお勧めします。

<div align="right">
<a href="#">⬆️ 先頭に戻る</a>
</div>

### constexprの使い方

- 【必須】インライン化を強制する目的で、`constexpr`を使用してはいけません。
- 【推奨】C++11では、真の定数を定義するときや、定数初期化を保証するときに、`constexpr`の使用を推奨します。

<div align="right">
<a href="#">⬆️ 先頭に戻る</a>
</div>

### 整数型

- 【必須】ループカウンタなど、オーバフローの心配がないとわかっている整数には、`int`を使用しなければなりません。
- 【必須】プログラムが異なるサイズの変数を必要とするときは、`<stdint.h>`から`int16_t`のような、サイズを明示した整数型を使用しなければなりません。
- 【必須】64ビットの整数型を使用するときは、`int64_t`か`uint64_t`を使用しなければなりません。
- 【推奨】`uint32_t`等の`unsigned`な整数型は、明確な理由がない限り使用を推奨しません。たとえば、変数が数値ではなくビットパターンを表している場合や、意図的にオーバーフローさせて`2^N`による剰余が必要な場合などは、使用を推奨します。
- 【推奨】`unsigned`型は、整数が負にならないことを伝える目的で、使用することは推奨しません。そのようなときは、`assertion`の使用を推奨します。

<div align="right">
<a href="#">⬆️ 先頭に戻る</a>
</div>

### 整数型64ビットへの移植性

- 【必須】コードは、64ビットと32ビットの両方にフレンドリーでなければなりません。`print`や、比較するとき、構造体のアラインメントの問題に気をつけます。
- 【必須】特にディスクに格納する場合、構造体のアライメントに気をつけなければなりません。64ビットシステムにおいて、`int64_t`か`uint64_t`を含むクラスや構造体は、デフォルトで8バイト境界にアラインメントされます。

<div align="right">
<a href="#">⬆️ 先頭に戻る</a>
</div>

### プリプロセッサマクロ

- 【必須】C++のAPIを定義するとき、マクロを使用してはいけません。
- 【必須】C++の偏った構造を拡張する目的で、マクロを使用してはいけません。
- 【必須】マクロを定義するとき、`.h`ファイルで定義してはいけません。
- 【必須】既存のマクロを、自分のものに置き換える目的で、`#undef`を使用してはいけません（debug、テストは除きます）。
- 【推奨】特にヘッダにおいて、マクの定義を避け、極力インライン関数、`enum`、`const`変数の使用を推奨します。
- 【推奨】関数名やクラス名、変数名を生成する目的で、`##`を使用することは推奨しません。

<div align="right">
<a href="#">⬆️ 先頭に戻る</a>
</div>

### 0とnullptrとNULL

- 【必須】整数は`0`、実数は`0.0`、ポインタは`nullptr`、文字は`'\0'`を使用しなければなりません。
- 【必須】C++03では、`0`より`NULL`を使用しなければなりません。

<div align="right">
<a href="#">⬆️ 先頭に戻る</a>
</div>

### sizeof

- 【推奨】`sizeof`（型）よりも、`sizeof`（変数名）の使用を推奨します。

<div align="right">
<a href="#">⬆️ 先頭に戻る</a>
</div>

### 型推論（autoを含む）

- 【必須】関数定義の戻り値に、`auto`は使用してはいけません。
- 【推奨】型推論は、コードが分かりやすくなるときや、安全になるとき、使用することを推奨します。

<div align="right">
<a href="#">⬆️ 先頭に戻る</a>
</div>

### クラステンプレートのテンプレート引数推論

- 【必須】クラステンプレート引数推論（例：`std::array a = {1, 2, 3};`）は　、C++17以前に書かれたコードでは、意図どおり動かないことがあるので使用してはいけません。

<div align="right">
<a href="#">⬆️ 先頭に戻る</a>
</div>

### ラムダ式

- 【必須】ラムダ式は、適切な場合に限り使用しなければなりません。書式は、ラムダ式の書式に従わなければなりません。
- 【必須】ラムダ式が、現在のスコープの外に渡されるときは、解放されたポインタへの参照を起こす可能性があるため、明示的なキャプチャを使用しなければなりません。
- 【必須】参照によるデフォルトキャプチャ`[&]`は、ラムダの寿命がキャプチャされるいずれの変数より、短いときにだけ使用しなければなりません。
- 【必須】値によるデフォルトキャプチャ`[=]`は、キャプチャされた変数が、単純で短いときにだけ使用しなければなりません。

<div align="right">
<a href="#">⬆️ 先頭に戻る</a>
</div>

### テンプレートメタプロラミング

- 【必須】複雑なテンプレートメタプログラミングは、極力避けなければなりません。デバッグやメンテナンスが大変になります。どうしても必要なときは、可能な限り複雑さを避け、ユーザから隠蔽するようにしなければなりません。
- 【必須】ユーザが誤用したときのエラーメッセージは、極力わかりやすくなるよう注意を払わなければなりません。

<div align="right">
<a href="#">⬆️ 先頭に戻る</a>
</div>

### boost

- 【必須】boostは通常、機能を作るときに使用してはいけません。

<div align="right">
<a href="#">⬆️ 先頭に戻る</a>
</div>

### std::hash

- 【必須】新しい型をサポートする目的で、`std::hash`の特殊化を定義してはいけません（すでに使用可能な型に、`std::hash`を使用するのはかまいません）。

<div align="right">
<a href="#">⬆️ 先頭に戻る</a>
</div>

### その他のC++の機能

- 【必須】コンパイル時の有理数`<ratio>`は、テンプレートを多用したインターフェイスのスタイルに結びついてしまう可能性があるため、使用してはいけません。
- 【必須】`<cfenv>`および`<fenv.h>`ヘッダは、多くのコンパイラがこれらの機能を確実にサポートしていないため、使用してはいけません。
- 【必須】`<filesystem>`ヘッダは、テストのための十分なサポートがなく、固有のセキュリティの脆弱性があるため、使用してはいけません。

<div align="right">
<a href="#">⬆️ 先頭に戻る</a>
</div>

### 非標準の拡張

- 【必須】 C++に対する非標準の拡張は、あらかじめ決められているものを除き、使用してはいけません。
  - GCCのattribute
  - intrinsic関数
  - `Foo f = {.field = 3}`のような指示付き初期化
  - `elvis operator(a?:b)`など

ただし、非標準の拡張機能に関する移植性を保つためのラッパーが提供されている場合は、それらを通してのみ非標準の機能を使用してもかまいません。

<div align="right">
<a href="#">⬆️ 先頭に戻る</a>
</div>

### エイリアス

- 【必須】`public`なエイリアスは、APIの使用者に役立つ内容だけにし、文書化しなければなりません。
- 【必須】`namespace`のエイリアスを、`public`なAPIの中においてはいけません。

<div align="right">
<a href="#">⬆️ 先頭に戻る</a>
</div>

## 命名規則

### 一般的な命名規則

- 【必須】頭字語や略語は、可読性を重視し、最小限にしなければなりません。
- 【必須】単語の中の文字を、省略して短くしてはいけません。反対に、過度の冗長も避けなれければなりません。

```cpp
// 悪い例：過度の冗長
int total_number_of_foo_errors = 0;
```

<div align="right">
<a href="#">⬆️ 先頭に戻る</a>
</div>

### ファイル名

- 【必須】ファイル名は、パスカルケース（単語の始まりを大文字で開始）を使用しなければなりません。
- 【必須】プロジェクトの命名規則に準拠しなければなりません。プロジェクトで特別な規定が存在しない場合、アンダースコア`_`を使用しなければなりません。
- 【必須】ファイル名は、可読性の高い命名にしなければなりません。たとえば、`db.h`よりも`DB.h`、`http_server_logs.h`よりも`HttpServerLogs.h`としなければなりません。

非常に良くあるパターンは、ファイルをペアにする方法です。たとえば、`FooBar.h`と`FooBar.cpp`で、クラス`FooBar`を定義する方法です。

<div align="right">
<a href="#">⬆️ 先頭に戻る</a>
</div>

### 型の名前

- 【必須】型の名前は、パスカルケース（単語の始まりを大文字で開始）にしなければなりません。スネークケース（単語をアンダースコア`_`で連結）は使用してはいけません。

```cpp
// 正しい例：パスカルケース
CurrentOwnerItem
// 悪い例：スネークケース
current_owner_item
```

<div align="right">
<a href="#">⬆️ 先頭に戻る</a>
</div>

### 変数名

- 【推奨】変数名（関数の引数も含む）や、データメンバ名は、キャメルケース（先頭を除く単語の始まりを英語で開始）の使用を推奨します（例：`tableName`）。
- 【推奨】クラス（構造体は含まず）のデータメンバ名は、先頭にアンダースコア`_`を付与したキャメルケースの使用を推奨します（例：`_tableName`）。
- 【推奨】構造体のデータメンバはstaticであるなしにかかわらず、クラス（構造体は含まず）のデータメンバ名と同様の命名規則を推奨します（例：`_tableName`）。

<div align="right">
<a href="#">⬆️ 先頭に戻る</a>
</div>

### 定数名

- 【推奨】`constexpr`、または`const`で宣言された定数は、大文字とキャメルケース（先頭を除く単語の始まりを英語で開始）の使用を推奨します（例：`MAX_NUM`）。

<div align="right">
<a href="#">⬆️ 先頭に戻る</a>
</div>

### 関数名

- 【推奨】通常の関数は、キャメルケース（先頭を除く単語の始まりを英語で開始）の使用を推奨します（例：`getNumber()`）。
- 【推奨】アクセサ`Getter`やミューテータ`Setter`も、通常の関数と同様の命名を推奨します（例：`number()`、`getNumber()`、`setNumber()`）。

<div align="right">
<a href="#">⬆️ 先頭に戻る</a>
</div>

### 名前空間

- 【必須】名前空間名はすべて小文字にしなければなりません。
- 【推奨】トップレベルの名前空間の名前は、通常はプロジェクト名か、そのコードが格納されるチームの名前であることを推奨します（例：`cocone`）。

<div align="right">
<a href="#">⬆️ 先頭に戻る</a>
</div>

### 列挙型

- 【必須】列挙型の名前は、パスカルケース（単語の始まりを大文字で開始）にしなければなりません。
- 【必須】列挙型の個々の値は、定数同様、大文字とキャメルケース（先頭を除く単語の始まりを英語で開始）を使用しなければなりません。

```cpp
enum class AlternateUrlTableError {
    OK = 0,
    OUT_OF_MEMORY = 1,
    MALFORMED_INPUT = 2,
};
```

<div align="right">
<a href="#">⬆️ 先頭に戻る</a>
</div>

### マクロ

- 【必須】原則として、マクロは使用してはいけません。
- 【必須】どうしてもマクロを使用する場合は、定数同様、大文字とキャメルケース（先頭を除く単語の始まりを英語で開始）を使用しなければなりません（例：`MY_MACRO`）。

<div align="right">
<a href="#">⬆️ 先頭に戻る</a>
</div>

### 命名規則の例外

- 【必須】既存のCや、C++のエンティティと類似したものに命名するときは、既存の命名規則にしたがわなければなりません。

<div align="right">
<a href="#">⬆️ 先頭に戻る</a>
</div>

## コメント

### コメントスタイル

- 【必須】コメントは、`/* */`と`//`のどちらを使用してもかまいませんが、一貫性を保ったスタイルでなければなりません。
- 【必須】原則として、コメントアウト機能目的で使用する`#if 0`は、使用してはいけません。

<div align="right">
<a href="#">⬆️ 先頭に戻る</a>
</div>

### クラスのコメント

- 【推奨】各クラスの宣言は、容易に分かる場合を除き、クラスの目的と使用方法について、コメントの追記を推奨します。
- 【推奨】クラスのコメントは、コードの読者が、そのクラスをいつどのように使用すればよいか分かるように記述することを推奨します。
- 【推奨】使用方法のコメントは`.h`に、内部動作のコメントは`.cpp`に記載することを推奨します。

<div align="right">
<a href="#">⬆️ 先頭に戻る</a>
</div>

### 関数のコメント

- 【推奨】関数の宣言は、容易に分かる場合を除き、関数の目的と使用方法について、コメントの追記を推奨します。
- 【推奨】コメントは、使用方法を書きます。内部動作の記載は推奨しません。また、コメントの使いまわしも推奨しません。
- 【推奨】関数が特殊な処理をしている場合、それを説明するコメントの追記を推奨します。

<div align="right">
<a href="#">⬆️ 先頭に戻る</a>
</div>

### 変数のコメント

- 【必須】変数名は、目的が十分に伝わる名前をつけなければなりません。
- 【必須】原則として、グローバル変数は使用してはいけません。どうしても必要な場合、その変数が何を表していて何のために使用され、なぜグローバルの必要があるのかをコメントで追記しなければなりません。
- 【推奨】特殊な意味をもつ値（例：`nullptr`や`-1`）を使用するとき、コメントの追記を推奨します。

<div align="right">
<a href="#">⬆️ 先頭に戻る</a>
</div>

### 実装のコメント

- 【必須】特殊や、複雑なコードブロックには、コメントを追記しなければなりません。

<div align="right">
<a href="#">⬆️ 先頭に戻る</a>
</div>

### 関数の引数のコメント

- 【推奨】引数のコメントは推奨しません。

以下を検討します。

- 引数がリテラル定数で、複数の呼び出しで同一の定数が与えられるときは、名前付きの定数を使用します。
- `bool`の代わりに、`enum`を使用します。
- 複数の設定項目は、ひとつの`option`構造体/クラスに入れます。
- 長くて複雑なネストを含む式は、名前付きの変数で分割します。

<div align="right">
<a href="#">⬆️ 先頭に戻る</a>
</div>

### TODOコメント

- 【必須】TODOは、大文字の`TODO`から始め、関連情報を追記しなければなりません。

関連情報の例は、次になります。

- もっともよく知る人の名前やメールアドレス
- イシュー
- バグ管理番号
- その他の識別子など

```cpp
// TODO（yamada@cocone.co.jp）: 連結演算子にはここで「*」を使用します
// TODO（Yamada）は、リレーションを使用するようにこれを変更します
// TODO（バグ12345）: 「最後の訪問者」機能を削除します
```

<div align="right">
<a href="#">⬆️ 先頭に戻る</a>
</div>

## コードのフォーマット

### 行の長さ

- 【推奨】コードの各行の長さは、例外を除き、`80`文字までを推奨します。

例外は、次になります。

- 切ると読みにくくなるコメント
- 生の文字列リテラル
- `#include`文
- ヘッダガード
- `using`宣言

<div align="right">
<a href="#">⬆️ 先頭に戻る</a>
</div>

### 非ASCII文字

- 【必須】読みやすいようであれば、16進数によるエンコーディングを使用します。`\uXXXX`エスケープが入ったリテラルは、`u8`接頭辞を使用してUTF-8であることを保証しなければなりません。
- 【必須】C++11の文字型`char16_t`と`char32_t`は、UTF-8以外のエンコードのためのものなので、使用してはいけません。
- 【必須】同様の理由で、`wchar_t`も使用してはいけません。
- 【推奨】ユーザが目にする文字列を、ハードコーディングすることは推奨しません。

<div align="right">
<a href="#">⬆️ 先頭に戻る</a>
</div>

### インデント

- 【必須】インデントは、半角スペース4つとしなければなりません。
  
<div align="right">
<a href="#">⬆️ 先頭に戻る</a>
</div>

### 関数宣言と関数定義

- 【必須】関数の戻り値の型は、1行に収まるのであれば、関数名や引数の型と同じ行に記述しなければなりません。
- 【必須】関数の引数のリストが1行に収まらない場合は、関数呼び出しと同様の方法で、行を分割しなければなりません。
- 【必須】開始丸括弧`(`は、関数名と同じ行に書かなければなりません。
- 【必須】指定の終わりの波括弧`}`の直後は、改行を指定するか、開始波括弧`{`と同じ行に書かなければなりません。
- 【必須】すべての引数を整列させなければなりません。
- 【推奨】関数名と開始丸括弧`(`の間に、スペースを入れないことを推奨します。
- 【推奨】開始丸括弧`(`と引数の間に、スペースを入れないことを推奨します。
- 【推奨】開始波括弧`{`は、関数宣言の最後の行に書くことを推奨します。次の行の先頭に書くことは推奨しません。
- 【推奨】終了丸括弧`)`と開始波括弧`{`の間に、スペースを入れることを推奨します。
- 【推奨】引数リストで行を分割した場合のインデントは、半角スペース4つを推奨します。

```cpp
// 正しい例：
int calcPlus(int arg1, int arg2) {
    return arg1 + arg2;
}
```

<div align="right">
<a href="#">⬆️ 先頭に戻る</a>
</div>

### ラムダ式

- 【必須】ラムダ式について、引数リストと関数定義の書式（`{}`区間）は、通常の関数と同様にしなければなりません。
- 【必須】キャプチャリストは、通常のコンマ区切にしなければなりません。
- 【必須】参照キャプチャのアンパサンド`&`と変数名の間は、半角スペースを入れてはいけません。
- 【必須】短いラムダ式は、関数の引数としてインラインで書かなければなりません。

<div align="right">
<a href="#">⬆️ 先頭に戻る</a>
</div>

### 浮動小数点リテラル

- 【推奨】`exponential`表記でも、必ず小数点を付け、両側に数字を書くことを推奨します（悪い例：`1.f`、`.1L`）。

<div align="right">
<a href="#">⬆️ 先頭に戻る</a>
</div>

### 関数呼び出し

- 【必須】関数呼び出しは、次のいずれかでなければなりません。
  - 1行で書く
  - 開始丸括弧`(`の後改行し、引数を次の行以降に書く
  - 半角スペース4つでインデントした新しい行に引数リストを書く
- 【必須】引数リストが1行に収まらない場合、それらを複数の行に分割しなければなりません。その場合、後続の行は最初の引数に揃えなければなりません。
- 【推奨】開始丸括弧`(`の直後や、終了丸括弧`)`の直前に、半角スペースを入れることは推奨しません。

```cpp
// 正しい例：
my_widget.Transform(x1, x2, x3,
                    y1, y2, y3,
                    z1, z2, z3);
```

<div align="right">
<a href="#">⬆️ 先頭に戻る</a>
</div>

### 波括弧による初期化子リスト

- 【必須】波括弧`{}`の初期化子リストは、関数呼び出しと同じフォーマットにしなければなりません。

<div align="right">
<a href="#">⬆️ 先頭に戻る</a>
</div>

### 条件文

- 【推奨】`if`文と開始丸括弧`(`の間、終了丸括弧`)`と開始波括弧`{`の間に、半角スペースを1つ入れることを推奨します（括弧と条件、または初期化子の間に、半角スペースは入れません）。
- 【推奨】`if`、`else if`、`else`に続く制御文には、波括弧`{}`を使用します。開始波括弧`{`の直後と終了波括弧`}`の直前で、改行を推奨します。
- 【推奨】後続に`else`がある場合、半角スペースで区切り、直前の終了波括弧`}`と同じ行での指定を推奨します。
- 【推奨】`if`文に`else`や`else if`が存在しない場合、制御文の波括弧`{}`や、波括弧内の改行の省略を推奨します。
- 【推奨】短い`if`文で、`else`が付かない場合、1行にすることを推奨します（例：`if (x == kFoo) return new Foo();`）。

<div align="right">
<a href="#">⬆️ 先頭に戻る</a>
</div>

### switch文

- 【必須】`switch`文でブロックを使用する場合、波括弧`{}`を使用しなければなりません。
- 【必須】`case`の後のブロックは、波括弧`{}`で囲まなければなりません。
- 【必須】`default`は、必ず書かなければなりません。絶対に`default`が実行されない場合、エラーとして扱います。

<div align="right">
<a href="#">⬆️ 先頭に戻る</a>
</div>

### ループ

- 【必須】1つの文からなるループでも、波括弧`{}`で囲まなければなりません。
- 【必須】デバッグ時にループ本体が空になる場合、波括弧`{}`による空のブロックとするか、波括弧なしの`continue`を使用しなければなりません。セミコロンだけを書いてはいけません。

<div align="right">
<a href="#">⬆️ 先頭に戻る</a>
</div>

### ポインタと参照の表現

- 【必須】`.`や`->`の前後に、スペースを入れてはいけません。
- 【必須】`*`や`&`の後に、スペースを入れてはいけません。

```cpp
x = *p;
p = &x;
x = r.y;
x = r->y;
```

- 【必須】複数の変数を宣言する場合、`int x, *y;`ではなく、` int x, y;`と宣言しなければなりません。

<div align="right">
<a href="#">⬆️ 先頭に戻る</a>
</div>

### ブーリアンの表現

- 【必須】改行を入れる場合、`&&`演算子や、`||`演算子の位置は、一貫性を持たせなければなりません。
- 【推奨】`&&`演算子や、`||`演算子の後ろに改行を入れることを推奨します。

```cpp
if (this_one_thing > this_other_thing &&
    a_third_thing == a_fourth_thing &&
    yet_another && last_one) {
    ...
}
```

- 【必須】演算子は、`and`や`compl`のような単語による演算子ではなく、常に`&&`や`~`のような記号による演算子を使用しなければなりません。

<div align="right">
<a href="#">⬆️ 先頭に戻る</a>
</div>

### 戻り値

- 【必須】`return`文の式を、不必要に丸括弧`()`で囲んではいけません。

```cpp
// 良い例：複雑な式を読みやすくするために、丸括弧を使用
return (some_long_condition &&
        another_condition);

// 悪い例：var = (value);と書いてはいけない
return (value);
```

<div align="right">
<a href="#">⬆️ 先頭に戻る</a>
</div>

### 変数と配列の初期化

- 初期化は、`int x=3;`でも、`int x(3);`でも、`int x{3};`でもよいこととします。

```cpp
int x = 3;
int x(3);
int x{3};
std::string name = "Some Name";
std::string name("Some Name");
std::string name{"Some Name"};
```

<div align="right">
<a href="#">⬆️ 先頭に戻る</a>
</div>

### プリプロセッサディレクティブ

- 【必須】プリプロセッサディレクティブに使用する`#`は、常に行の先頭でなければなりません。

<div align="right">
<a href="#">⬆️ 先頭に戻る</a>
</div>

### クラス

- 【推奨】クラス内のセクションは、`public`、`protected`、`private`の順で並べることを推奨します。
- 【推奨】`public:`と`protected:`と`private:`は、インデントしないことを推奨します。

```cpp
class MyClass : public OtherClass {
public:
    MyClass();
    explicit MyClass(int var);
    ~MyClass() {}

    void SomeFunction();

    void set_some_var(int var) { some_var_ = var; }
    int some_var() const { return some_var_; }

private:
    bool SomeInternalFunction();

    int some_var_;
    int some_other_var_;
};
```
- 【推奨】最初のキーワードを除き、宣言の前に空行の追加を推奨します（小さなクラスは除きます）。

<div align="right">
<a href="#">⬆️ 先頭に戻る</a>
</div>

### コンストラクタの初期化子リスト

- 【必須】コンストラクタの初期化子リストは、1行で書くか、行を分けて、2行目以降を半角スペース4つでインデントして書かなければなりません。

```cpp
// 良い例：1行にすべて収まるとき
MyClass::MyClass(int var) : some_var_(var) {
    DoSomething();
}

// 良い例：1行に収まらない場合。コロンの手前で行を区切り、スペース4つでインデントしなくてはならない
MyClass::MyClass(int var)
    : some_var_(var), some_other_var_(var + 1) {
    DoSomething();
}
```

<div align="right">
<a href="#">⬆️ 先頭に戻る</a>
</div>

### 名前空間のフォーマット

- 【必須】ネストされた名前空間を宣言するときは、各名前空間ごとに別の行にわけなければなりません。

```cpp
namespace foo {
namespace bar {
```

<div align="right">
<a href="#">⬆️ 先頭に戻る</a>
</div>

### 水平方向

- 【必須】`{}`初期化子の波括弧`{}`の内側に半角スペース1つで離す場合、両側を離さなければなりません。
- 【必須】`class Foo : public Bar {...};`の`:`の前後は、半角スペース1つで離さなければなりません。
- 【必須】行を分ける場合、位置揃えのために、半角スペースを使用しなければなりません。
- 【必須】行の最後に、空白を入れてはいけません。
- 【必須】二項演算子の前後は、項の中を除き、半角スペース1つで離さなければなりません。
- 【必須】単項演算子とオペラントの間は、半角スペースを入れてはいけません。
- 【必須】テンプレートの`<>`の中は、半角スペースを入れてはいけません。
- 【必須】空行は、最低限にしなければなりません。
- 【推奨】開始波括弧`{`の前は、半角スペース1つで離すことを推奨します。
- 【推奨】`for`文の、丸括弧`()`中のセミコロン`;`の後は、半角スペース1つで離すことを推奨します。
- 【推奨】範囲`for`文の、コロン`:`の前後は、半角スペース1つで離すことを推奨します。
- 【推奨】`case`文の、コロン`:`の前は、半角スペースを入れないことを推奨します。
- 【推奨】代入演算子`=`の前後は、半角スペース1つで離すことを推奨します。

<div align="right">
<a href="#">⬆️ 先頭に戻る</a>
</div>